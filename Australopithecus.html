<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australopithecus - Modelo Interactivo</title>
    <style>
        :root {
            --background: transparent;
            --text: #ffffff;
            --accent: #ffa149;
            --node: #ff6b6b;
            --node-hover: #ff4757;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            position: relative;
        }

        /* Modelo y contenedor */
        .model-container {
            position: relative;
            width: 100%;
            height: 80vh; /* Reducido para evitar scroll vertical */
            margin: 0 auto;
            background: transparent;
            border-radius: 50% / 90% 90% 10% 10%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .model-wrapper {
            position: relative;
            width: 95%; /* Aumentado de 90% a 95% */
            height: 95%; /* Aumentado de 90% a 95% */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .model-video {
            width: auto;
            height: 120%; /* Aumentado de 100% a 120% */
            max-width: 120%; /* Aumentado de 100% a 120% */
            object-fit: contain;
            border-radius: 50% / 90% 90% 10% 10%;
            box-shadow: none;
        }

        .node.hidden {
            display: none;
        }

        /* Nodos interactivos */
        .node {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--node);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #fff;
            box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.3);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #fff;
        }

        .node.visited {
            background: #4CAF50; /* Verde para visitados */
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.3);
        }

        .node.visited::before {
            background: radial-gradient(circle, rgba(76,175,80,0.2) 0%, transparent 70%);
        }

        .node::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,107,107,0.2) 0%, transparent 70%);
            animation: pulse 2s infinite;
        }

        .node:hover {
            transform: scale(1.2);
            background: var(--node-hover);
        }

        .node.visited:hover {
            background: #45a049;
        }

        .node.unvisited {
            background: #ccc; /* Gray for unvisited nodes */
        }

        /* Info panel */
        .info-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.92);
            backdrop-filter: blur(14px);
            padding: 1.75rem 2.5rem;
            border-radius: 14px;
            /* ancho adaptativo: hasta 1100px, o 90% del viewport */
            width: min(90vw, 1100px);
            min-width: 420px;
            visibility: hidden;
            opacity: 0;
            transition: all 0.2s ease;
            border: 1px solid var(--accent);
            z-index: 1001;
        }

        .info-panel.visible {
            visibility: visible;
            opacity: 1;
        }

        .info-title {
            color: var(--accent);
            font-size: 1.6rem;
            margin-bottom: 0.6rem;
        }

        .info-text {
            font-size: 1.05rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.98);
        }

        /* Ajustes responsivos para paneles m√°s grandes */
        @media (max-width: 720px) {
            .info-panel {
                width: 96vw;
                padding: 1rem 0.9rem;
                min-width: unset;
            }
            .info-title { font-size: 1.15rem; }
            .info-text { font-size: 0.98rem; line-height: 1.45; }
        }

        /* Animaciones */
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
            70% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        /* T√≠tulo y navegaci√≥n */
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .title {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px rgba(255, 161, 73, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 0.8rem 1.5rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--accent);
            color: var(--text);
            text-decoration: none;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--accent);
            color: #000;
        }

        /* Mini timeline para mostrar el recorrido */
        .journey-timeline {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 400px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            border: 1px solid var(--accent);
            z-index: 15;
            overflow-x: auto;
        }

        .journey-timeline::-webkit-scrollbar {
            height: 8px;
        }

        .journey-timeline::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .journey-timeline::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .journey-timeline::-webkit-scrollbar-thumb:hover {
            background: #e6933a;
        }

        .journey-title {
            color: var(--accent);
            font-size: 1rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .journey-steps {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: fit-content;
        }

        .journey-step {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            position: relative;
            flex: none;
        }

        .journey-step.active {
            background: var(--accent);
        }

        .journey-step::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }

        .journey-step.active::after {
            background: var(--accent);
            box-shadow: 0 0 10px rgba(255, 161, 73, 0.5);
        }

        .journey-labels {
            display: flex;
            margin-top: 0.5rem;
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.7);
            gap: 0.5rem;
            min-width: fit-content;
        }

        .journey-label {
            text-align: center;
            width: 80px;
            flex: none;
        }

        .journey-label.active {
            color: var(--accent);
            font-weight: bold;
        }

        /* Panel de progreso del tour */
        .tour-progress {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            border: 1px solid var(--accent);
            z-index: 15;
        }

        .tour-title {
            color: var(--accent);
            font-size: 1rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .tour-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .tour-step {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            position: relative;
        }

        .tour-step.completed {
            background: #4CAF50;
        }

        .tour-step.next {
            background: var(--accent);
        }

        .tour-step::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }

        .tour-step.completed::after {
            background: #4CAF50;
        }

        .tour-step.next::after {
            background: var(--accent);
            box-shadow: 0 0 10px rgba(255, 161, 73, 0.5);
        }

        .tour-instruction {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-top: 0.5rem;
        }

        /* Notificaciones personalizadas */
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 1rem 2rem;
            border-radius: 10px;
            border: 1px solid var(--accent);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            visibility: visible;
        }

        .notification.success {
            border-color: #4CAF50;
        }

        .notification.info {
            border-color: var(--accent);
        }

        /* Background video */
        .background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: -1;
        }

        /* Mensaje lateral izquierdo */
        .mobile-app-message {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            width: 250px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            border: 1px solid var(--accent);
            z-index: 15;
            text-align: center;
        }

        .mobile-app-title {
            color: var(--accent);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .mobile-app-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
        }

        /* Logo styles */
        .logo-link {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--text);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .logo-link:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.05);
        }

        .logo-image {
            height: 30px;
            width: auto;
        }

        .logo-text {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
        }

        /* Styles for the infoPanel table */
        #infoPanel table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        #infoPanel th, #infoPanel td {
            border: 1px solid var(--accent);
            padding: 0.5rem;
            text-align: left;
            word-wrap: break-word;
        }
        #infoPanel th {
            background-color: rgba(255, 161, 73, 0.1);
        }
    </style>
</head>
<body>
    <video class="background-video" autoplay muted loop playsinline>
        <source src="https://i.imgur.com/1IISPsS.mp4" type="video/mp4">
    </video>
    <div class="video-overlay"></div>

    <!-- Logo in top-left corner -->
    <a href="index.html" class="logo-link" title="Ir a la p√°gina principal">
        <img src="https://i.imgur.com/zdK1P5m.png" alt="Genus Logo" class="logo-image">
        <span class="logo-text">Genus</span>
    </a>

    <a href="Humanos.html" class="back-button" style="top: 80px;">‚Üê Volver a la l√≠nea temporal</a>

    <!-- Mini timeline del recorrido -->
    <div class="journey-timeline">
        <div class="journey-title">Tu Recorrido</div>
        <div class="journey-steps">
            <div class="journey-step"></div>
            <div class="journey-step"></div>
            <div class="journey-step active"></div>
            <div class="journey-step"></div>
            <div class="journey-step"></div>
            <div class="journey-step"></div>
            <div class="journey-step"></div>
            <div class="journey-step"></div>
            <div class="journey-step"></div>
            <div class="journey-step"></div>
        </div>
        <div class="journey-labels">
            <div class="journey-label">Sahelanthropus</div>
            <div class="journey-label">Ardipithecus</div>
            <div class="journey-label active">Australopithecus</div>
            <div class="journey-label">Kenyanthropus</div>
            <div class="journey-label">Paranthropus</div>
            <div class="journey-label">Homo habilis</div>
            <div class="journey-label">Homo erectus</div>
            <div class="journey-label">Homo heidelbergensis</div>
            <div class="journey-label">Homo neanderthalensis</div>
            <div class="journey-label">Homo sapiens</div>
        </div>
    </div>

    <!-- Panel de progreso del tour -->
    <div class="tour-progress">
        <div class="tour-title">Tour Interactivo</div>
        <div class="tour-steps">
            <div class="tour-step completed" data-step="1"></div>
            <div class="tour-step next" data-step="2"></div>
            <div class="tour-step" data-step="3"></div>
            <div class="tour-step" data-step="4"></div>
            <div class="tour-step" data-step="5"></div>
        </div>
        <div class="tour-instruction">¬°Comienza explorando el cr√°neo!</div>
    </div>

    <!-- Notificaci√≥n -->
    <div class="notification" id="notification">
        Da clic a los nodos para comenzar el recorrido.
    </div>



    <div class="container">
        <header class="header">
            <h1 class="title">Australopithecus</h1>
            <p class="subtitle">Modelo Interactivo - 4-2 millones de a√±os</p>
        </header>

        <!-- Bot√≥n para desplegar di√°logo "¬øSab√≠as que?" -->
        <button id="toggleInfoBtn" style="position: fixed; left: 50px; top: 150px; z-index: 1001; padding: 0.6rem 1rem; background-color: var(--accent); border: none; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer;">
            ¬øSab√≠as que?
            
        </button>

        <!-- Cuadro de di√°logo desplegable desde la izquierda -->
        <div id="infoPanel" style="position: fixed; top: 200px; left: -400px; width: 400px; height: 50vh; background: rgba(0,0,0,0.95); color: #fff; padding: 1rem; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.7); transition: left 0.3s ease-in-out; z-index: 1000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            <h2 style="color: var(--accent); text-align: center; margin-bottom: 1rem;">¬øSab√≠as que?</h2>
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                <thead>
                    <tr>
                        <th style="border-bottom: 1px solid var(--accent); padding: 0.25rem; text-align: left;">Especie / tema</th>
                        <th style="border-bottom: 1px solid var(--accent); padding: 0.25rem; text-align: left;">Link / fuente</th>
                        <th style="border-bottom: 1px solid var(--accent); padding: 0.25rem; text-align: left;">Qu√© puedes ver / aprender</th>
                    </tr>
                </thead>
                <tbody>
                    Hay otras especies de Australopithecus, de los cuales puedes aprender m√°s aqu√≠:
                    <tr>
                        <td><strong>Australopithecus afarensis</strong></td>
                        <td><a href="https://humanorigins.si.edu/evidence/human-fossils/species/australopithecus-afarensis" target="_blank" style="color: var(--accent);">Human Origins</a></td>
                        <td>P√°gina con fotos de cr√°neos, restos, edad, distribuci√≥n, volumen cerebral, estilo de vida, dieta y locomoci√≥n.</td>
                    </tr>
                    <tr>
                        <td><strong>Australopithecus africanus</strong></td>
                        <td><a href="https://humanorigins.si.edu/evidence/human-fossils/species/australopithecus-africanus" target="_blank" style="color: var(--accent);">Human Origins</a></td>
                        <td>Restos f√≥siles, anatom√≠a comparada, postura, adaptaciones para bipedalismo y trepar.</td>
                    </tr>
                    <tr>
                        <td><strong>Australopithecus sediba</strong></td>
                        <td><a href="https://humanorigins.si.edu/evidence/human-fossils/species/australopithecus-sediba" target="_blank" style="color: var(--accent);">Human Origins</a></td>
                        <td>Detalles del esqueleto, morfolog√≠a, evoluci√≥n hacia rasgos humanos, posible v√≠nculo con Homo.</td>
                    </tr>
                    <tr>
                        <td><strong>Australopithecus anamensis</strong></td>
                        <td><a href="https://www.nationalgeographic.es/ciencia/2019/08/craneo-sin-precedentes-rostro-australopithecus-anamensis" target="_blank" style="color: var(--accent);">National Geographic</a></td>
                        <td>Hallazgo reciente del cr√°neo, rasgos craneales e importancia evolutiva.</td>
                    </tr>
                    <tr>
                        <td><strong>Contexto general Australopithecus</strong></td>
                        <td><a href="https://www.nationalgeographic.com.es/ciencia/asi-lucia-antepasado-lucy-australopithecus_14656" target="_blank" style="color: var(--accent);">National Geographic</a></td>
                        <td>Resumen evolutivo, comparaciones, fechas e implicaciones en el origen del g√©nero Homo.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="model-container">
            <div class="model-wrapper">
                <video src="https://i.imgur.com/68qLxLz.mp4" class="model-video" autoplay muted playsinline>
                    Tu navegador no soporta el elemento video.
                </video>

                <!-- Nodos interactivos -->
<div class="node hidden" style="top: 10%; left: 50%" data-info="craneo" data-order="1">
    <div class="info-panel">
        <h3 class="info-title">Cr√°neo</h3>
        <p class="info-text">
        Tama√±o cerebral reducido: 400‚Äì550 cm¬≥, un tercio del cerebro humano moderno.<br>
        B√≥veda craneal baja con frente inclinada y arcos supraorbitales marcados.<br>
        Foramen magnum adelantado, evidencia de postura erguida y bipedalismo.<br>
        Rasgos primitivos similares a simios, pero con adaptaciones humanas incipientes.<br>
        Importante en la evoluci√≥n hacia g√©neros posteriores como Homo.<br><br>
        <strong>üìé Fuente:</strong><br>
        ‚Ä¢ <a href="https://humanorigins.si.edu/education/teachers/hominid-skull-categories" target="_blank">Smithsonian ‚Äì Human Origins: Australopithecus Overview</a>
        </p>
        <p class="info-status" id="status-1">Estado: No visitado</p>
    </div>
</div>

<div class="node hidden" style="top: 18%; left: 52%" data-info="cara" data-order="2">
    <div class="info-panel">
        <h3 class="info-title">Regi√≥n Facial</h3>
        <p class="info-text">
        Cara proyectada hacia adelante con prognatismo y mand√≠bula prominente.<br>
        Nariz peque√±a con puente nasal bajo, t√≠pica de hom√≠nidos primitivos.<br>
        Arcos zigom√°ticos robustos que soportan m√∫sculos de masticaci√≥n fuertes.<br>
        Mand√≠bulas pesadas, adaptadas para dietas con alto esfuerzo masticatorio.<br>
        Rasgos faciales que reflejan una alimentaci√≥n variada y dura.<br><br>
        <strong>üìé Fuente:</strong><br>
        ‚Ä¢ <a href="https://australian.museum/learn/science/human-evolution/australopithecus/" target="_blank">Australian Museum ‚Äì Characteristics of Australopithecus</a>
        </p>
        <p class="info-status" id="status-2">Estado: No visitado</p>
    </div>
</div>

<div class="node hidden" style="top: 22%; left: 50%" data-info="dientes" data-order="3">
    <div class="info-panel">
        <h3 class="info-title">Dentici√≥n y Mand√≠bula</h3>
        <p class="info-text">
        Premolares y molares grandes, adaptados para triturar alimentos duros o fibrosos.<br>
        Caninos reducidos, sin el ‚Äúafilado‚Äù t√≠pico de los simios.<br>
        Mand√≠bulas anchas y potentes, dise√±adas para dietas variadas: ra√≠ces, frutos, hojas duras.<br>
        Dientes con esmalte grueso para resistir desgaste por alimentos abrasivos.<br>
        Adaptaciones dentales que indican una dieta omn√≠vora y procesadora de alimentos.<br><br>
        <strong>üìé Fuente:</strong><br>
        ‚Ä¢ <a href="https://humanorigins.si.edu/evidence/human-characteristics/diet-and-teeth" target="_blank">Smithsonian ‚Äì Teeth and Diet in Early Hominins</a>
        </p>
        <p class="info-status" id="status-3">Estado: No visitado</p>
    </div>
</div>

<div class="node hidden" style="top: 50%; left: 46%" data-info="foramen" data-order="4">
    <div class="info-panel">
        <h3 class="info-title">Postura y Locomoci√≥n</h3>
        <p class="info-text">
        B√≠pedos regulares: caminaban erguidos en el suelo con postura erguida.<br>
        Pelvis corta y ancha, adaptada para estabilidad en bipedalismo.<br>
        F√©mures inclinados hacia adentro y rodillas dise√±adas para soportar peso.<br>
        Pies con arco parcial y dedo gordo alineado, facilitando la marcha.<br>
        Locomoci√≥n menos eficiente que en humanos modernos, pero efectiva.<br><br>
        <strong>üìé Fuente:</strong><br>
        ‚Ä¢ <a href="https://espanol.libretexts.org/.../Locomoci√≥n_Australopitecina" target="_blank">LibreTexts ‚Äì La locomoci√≥n australopitecina</a>
        </p>
        <p class="info-status" id="status-4">Estado: No visitado</p>
    </div>
</div>

<div class="node hidden" style="top: 55%; left: 57%" data-info="manos" data-order="5">
    <div class="info-panel">
        <h3 class="info-title">Manos y Extremidades Superiores</h3>
        <p class="info-text">
        Brazos largos en proporci√≥n al cuerpo, indicando capacidad para trepar.<br>
        Dedos curvados y pulgares oponibles, adaptados para manipulaci√≥n y vida arb√≥rea.<br>
        Capaces de manipular objetos, pero sin evidencia de herramientas avanzadas.<br>
        Om√≥platos y clav√≠culas similares a simios, permitiendo movilidad arb√≥rea.<br>
        Extremidades superiores muestran mezcla de rasgos humanos y simios.<br><br>
        <strong>üìé Fuente:</strong><br>
        ‚Ä¢ <a href="https://link.springer.com/article/10.1007/s10437-024-09580-x" target="_blank">Journal of Human Evolution ‚Äì Upper limb morphology in early hominins</a>
        </p>
        <p class="info-status" id="status-5">Estado: No visitado</p>
    </div>
</div>
            </div>
        </div>
    </div>

    <script>
        // Funci√≥n para mostrar notificaciones
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Reset tour progress on page load for fresh start
        localStorage.removeItem('sahelanthropus-tour');
        let visitedNodes = [];
        let currentStep = 1;

        // Actualizar visuales iniciales
        function updateVisuals() {
            nodes.forEach(node => {
                const order = parseInt(node.dataset.order);
                const numberSpan = document.createElement('span');
                numberSpan.textContent = order;
                node.appendChild(numberSpan);

                if (visitedNodes.includes(order)) {
                    node.classList.remove('unvisited');
                    node.classList.add('visited');
                    document.getElementById(`status-${order}`).textContent = 'Estado: Visitado';
                } else {
                    node.classList.remove('visited');
                    node.classList.add('unvisited');
                    document.getElementById(`status-${order}`).textContent = 'Estado: No visitado';
                }
            });

            updateProgress();
        }

        // Actualizar barra de progreso
        function updateProgress() {
            const tourSteps = document.querySelectorAll('.tour-step');
            tourSteps.forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.remove('completed', 'next');
                if (visitedNodes.includes(stepNum)) {
                    step.classList.add('completed');
                } else if (stepNum === currentStep) {
                    step.classList.add('next');
                }
            });

            const instruction = document.querySelector('.tour-instruction');
            if (currentStep <= 5) {
                const nodeNames = ['cr√°neo', 'regi√≥n facial', 'dentici√≥n', 'foramen magnum', 'mand√≠bula'];
                instruction.textContent = `Siguiente: Explora el ${nodeNames[currentStep - 1]}`;
            } else {
                instruction.textContent = '¬°Tour completado! Has explorado todos los nodos.';
                showNotification('¬°Felicitaciones! Has completado el tour del hominido.', 'success');
            }
        }

        // Funciones auxiliares para manejo de paneles
        function closeAllPanels() {
            document.querySelectorAll('.info-panel.visible').forEach(panel => {
                panel.classList.remove('visible');
            });
            document.querySelectorAll('.node').forEach(n => n.style.visibility = 'visible');
            document.querySelectorAll('.lm-marker').forEach(m => m.style.visibility = 'visible');
            // Restaurar posici√≥n al DOM original dentro del wrapper si fue movido
            document.querySelectorAll('.info-panel').forEach(panel => {
                const originalParent = panel.closest('.node') || document.querySelector('.model-wrapper');
                if (panel.parentElement !== originalParent) {
                    originalParent.appendChild(panel);
                    panel.style.position = 'absolute';
                    panel.style.left = '';
                    panel.style.top = '';
                }
            });
        }

        function showInfoPanel(infoPanel, node) {
            // Ocultar otros paneles
            document.querySelectorAll('.info-panel').forEach(panel => panel.classList.remove('visible'));

            // Ocultar nodos y marcadores
            document.querySelectorAll('.node').forEach(n => n.style.visibility = 'hidden');
            document.querySelectorAll('.lm-marker').forEach(m => m.style.visibility = 'hidden');

            // Preparar panel: limitar altura y scroll vertical
            infoPanel.style.maxHeight = '75vh';
            infoPanel.style.overflowY = 'auto';

            // Calcular ancho preferido y ancho m√°ximo basado en viewport
            const wrapper = document.querySelector('.model-wrapper');
            const wrapperRect = wrapper.getBoundingClientRect();
            const nodeRect = node.getBoundingClientRect();

            const preferred = Math.min(wrapperRect.width * 0.65, 760);
            const maxAllowed = Math.max(wrapperRect.width - 24, 300);
            const panelWidth = Math.min(preferred, maxAllowed);
            infoPanel.style.width = panelWidth + 'px';
            infoPanel.style.minWidth = '300px';

            // Mover el panel fuera del contenedor (a body) para evitar que el borde radial lo corte
            if (infoPanel.parentElement !== document.body) {
                document.body.appendChild(infoPanel);
            }
            infoPanel.style.position = 'fixed';

            // Mostrar el panel para medir su tama√±o en el viewport
            infoPanel.classList.add('visible');
            const panelRect = infoPanel.getBoundingClientRect();

            // Calcular posici√≥n preferida: encima del nodo, centrado en X
            const nodeCenterX = nodeRect.left + nodeRect.width / 2;
            const margin = 12; // margen desde los bordes del viewport

            let left = Math.round(nodeCenterX - panelRect.width / 2);
            if (left < margin) left = margin;
            if (left + panelRect.width > window.innerWidth - margin) left = window.innerWidth - panelRect.width - margin;

            // Preferir colocar arriba del nodo
            let top = Math.round(nodeRect.top - panelRect.height - 12);
            if (top < margin) {
                // si no cabe arriba, colocar debajo
                top = Math.round(nodeRect.bottom + 12);
                // si tampoco cabe abajo, centrar verticalmente cercano al nodo
                if (top + panelRect.height > window.innerHeight - margin) {
                    top = Math.max(margin, Math.round((window.innerHeight - panelRect.height) / 2));
                }
            }

            infoPanel.style.left = left + 'px';
            infoPanel.style.top = top + 'px';
            infoPanel.style.transform = 'none';

            // A√±adir bot√≥n de cerrar si no existe
            if (!infoPanel.querySelector('.close-btn')) {
                const btn = document.createElement('button');
                btn.className = 'close-btn';
                btn.textContent = '√ó';
                btn.title = 'Cerrar';
                btn.style = 'position:absolute;top:8px;right:10px;background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer;z-index:1100;';
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    closeAllPanels();
                });
                infoPanel.appendChild(btn);
            }
        }

        // Manejar interacciones con los nodos
        const nodes = document.querySelectorAll('.node');

        nodes.forEach(node => {
            const infoPanel = node.querySelector('.info-panel');
            const order = parseInt(node.dataset.order);

            // Mostrar panel solo al hacer clic
            node.addEventListener('click', (e) => {
                showInfoPanel(infoPanel, node);
                // Evitar que el clic propague y cierre el panel inmediatamente
                e.stopPropagation();
            });

            // Ya no se usa mouseleave para ocultar el panel

            // Evitar que el clic dentro del panel cierre el panel
            infoPanel.addEventListener('click', (ev) => {
                ev.stopPropagation();
            });

            // Marcar como visitado al hacer clic
            node.addEventListener('click', () => {
                if (!visitedNodes.includes(order)) {
                    if (order === currentStep) {
                        visitedNodes.push(order);
                        node.classList.remove('unvisited');
                        node.classList.add('visited');
                        document.getElementById(`status-${order}`).textContent = 'Estado: Visitado';
                        currentStep++;
                        localStorage.setItem('sahelanthropus-tour', JSON.stringify(visitedNodes));
                        updateProgress();
                        showNotification(`¬°Excelente! Has explorado el ${node.dataset.info}.`, 'success');
                    } else {
                        showNotification(`¬°Sigue el orden! Primero explora el nodo ${currentStep}.`, 'info');
                    }
                }
            });
        });

        // Cerrar paneles al hacer clic fuera (un solo listener global)
        document.addEventListener('click', (ev) => {
            closeAllPanels();
        });

        // Cerrar con Escape
        document.addEventListener('keydown', (ev) => {
            if (ev.key === 'Escape') closeAllPanels();
        });

        // Toggle info panel
        document.getElementById('toggleInfoBtn').addEventListener('click', () => {
            const panel = document.getElementById('infoPanel');
            if (panel.style.left === '0px') {
                panel.style.left = '-400px';
            } else {
                panel.style.left = '0px';
            }
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.querySelector('.model-video');
            const nodes = document.querySelectorAll('.node');
            const backgroundVideo = document.querySelector('.background-video');

            // Mostrar nodos cuando el video se pause
            video.addEventListener('pause', () => {
                nodes.forEach(node => {
                    node.classList.remove('hidden');
                });
                updateVisuals();
                showNotification('Da clic a los nodos para comenzar el recorrido.', 'info');
            });

            // Ocultar nodos cuando el video se reproduzca
            video.addEventListener('play', () => {
                nodes.forEach(node => {
                    node.classList.add('hidden');
                });
            });

            // Ambos videos se reproducen autom√°ticamente (background y main model)
            video.addEventListener('loadeddata', () => {
                // No pausar el video principal, dejar que ambos se reproduzcan
            });
        });
    </script>
</body>
</html>